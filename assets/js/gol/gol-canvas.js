"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}(),GOLCanvas=function(){function e(t){_classCallCheck(this,e),this.configs=t,this.setup(),this.clear()}return _createClass(e,[{key:"setup",value:function(){this.context=null,this.width=null,this.height=null,this.age=null,this.helper=new GOLHelper,this.game=this.configs.game,this.cellList=null,this.columns=this.configs.columns,this.rows=this.configs.rows,this.cellSize=this.configs.zoom,this.cellSpace=1,this.canvasElem=$("#canvas"),this.canvas=this.canvasElem[0],this.context=this.canvas.getContext("2d"),this.trail={current:!0,schedule:!1},this.handlers={mouseDown:!1,lastX:0,lastY:0},this.canvasElem.on("mousedown",this.configs.mousedown),this.canvasElem.on("mousemove",this.configs.mousemove),$(document).on("mouseup",this.configs.mouseup)}},{key:"clear",value:function(){this.age=[];for(var e=0;e<this.columns;e++){this.age[e]=[];for(var t=0;t<this.rows;t++)this.age[e][t]=0}}},{key:"draw",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.cellList=e,this.trail.schedule&&(this.trail.schedule=!1),this.setDimensions(),this.context.fillRect(0,0,this.width,this.height);for(var t=0;t<this.columns;t++)for(var s=0;s<this.rows;s++){var i=this.game.getCell(t,s),l=!!i,h=i&&i[2]?i[2]:"#ff0000";this.context.fillStyle=h,this.drawCell(t,s,h,l)}}},{key:"setDimensions",value:function(){this.width=this.height=0,this.width=this.width+this.cellSpace*this.columns+this.cellSize*this.columns,this.canvasElem.width(this.width),this.height=this.height+this.cellSpace*this.rows+this.cellSize*this.rows,this.canvasElem.height(this.height)}},{key:"setNoGridOn",value:function(){this.cellSize=this.zoom+1,this.cellSpace=0}},{key:"setNoGridOff",value:function(){this.cellSize=this.zoom,this.cellSpace=1}},{key:"drawCell",value:function(e,t,s,i){i?this.age[e][t]>-1&&(this.context.fillStyle=s):this.trail.current&&this.age[e][t]<0?this.context.fillStyle="#ffffff":this.context.fillStyle="#000000",this.context.fillRect(this.cellSpace+this.cellSpace*e+this.cellSize*e,this.cellSpace+this.cellSpace*t+this.cellSize*t,this.cellSize,this.cellSize)}},{key:"switchCell",value:function(e,t){this.cellList.isAlive(e,t)?(this.cellList.removeCell(e,t),this.changeCelltoDead(e,t,"#000000")):(this.game.addCell(e,t,this.cellList.currentState),this.changeCelltoAlive(e,t,color))}},{key:"keepCellAlive",value:function(e,t,s){e>=0&&e<this.columns&&t>=0&&t<this.rows&&(this.age[e][t]++,this.drawCell(e,t,s,!0))}},{key:"changeCelltoAlive",value:function(e,t,s){e>=0&&e<this.columns&&t>=0&&t<this.rows&&(this.age[e][t]=1,this.drawCell(e,t,s,!0))}},{key:"changeCelltoDead",value:function(e,t,s){e>=0&&e<this.columns&&t>=0&&t<this.rows&&(this.age[e][t]=-this.age[e][t],this.drawCell(e,t,s,!1))}},{key:"mousePosition",value:function(e){var t,s,i,l,h=0,n=0,o=0,a=0,c=GOL.zoom.schemes[GOL.zoom.current].cellSize+1;for(t=e,t||(t=window.event),t.pageX||t.pageY?(h=t.pageX,n=t.pageY):(t.clientX||t.clientY)&&(h=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),l=t.target||t.srcElement;l.offsetParent;)a+=l.offsetLeft,o+=l.offsetTop,l=l.offsetParent;return l.pageTop=o,l.pageLeft=a,s=Math.ceil((h-l.pageLeft)/c-1),i=Math.ceil((n-l.pageTop)/c-1),[s,i]}},{key:"canvasMouseDown",value:function(e){var t=this.mousePosition(e);this.switchCell(t[0],t[1]),this.handlers.lastX=t[0],this.handlers.lastY=t[1],this.handlers.mouseDown=!0}},{key:"canvasMouseUp",value:function(){this.handlers.mouseDown=!1}},{key:"canvasMouseMove",value:function(e){if(this.handlers.mouseDown){var t=this.mousePosition(e);t[0]===this.handlers.lastX&&t[1]===this.handlers.lastY||(this.switchCell(t[0],t[1]),this.handlers.lastX=t[0],this.handlers.lastY=t[1])}}}]),e}();