"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}(),GOLCanvas=function(){function e(t){_classCallCheck(this,e),this.configs=t,this.setup(),this.clear()}return _createClass(e,[{key:"setup",value:function(){this.context=null,this.width=null,this.height=null,this.age=null,this.helper=new GOLHelper,this.game=this.configs.game,this.columns=this.configs.columns,this.rows=this.configs.rows,this.cellSize=this.configs.zoom,this.cellSpace=1,this.canvasElem=$("#canvas"),this.canvas=this.canvasElem[0],this.context=this.canvas.getContext("2d"),this.trail={current:!0,schedule:!1},this.handlers={mouseDown:!1,lastX:0,lastY:0},this.canvasElem.on("mousedown",this.configs.mousedown),this.canvasElem.on("mousemove",this.configs.mousemove),$(document).on("mouseup",this.configs.mouseup)}},{key:"clear",value:function(){this.age=[];for(var e=0;e<this.columns;e++){this.age[e]=[];for(var t=0;t<this.rows;t++)this.age[e][t]=0}}},{key:"draw",value:function(e){this.trail.schedule&&(this.trail.schedule=!1),this.setDimensions(),this.context.fillRect(0,0,this.width,this.height);for(var t=0;t<this.columns;t++)for(var s=0;s<this.rows;s++){var i=e.getCell(t,s),l=!!i,h=i&&i.params.color?i.params.color:"#ff0000";this.context.fillStyle=h,this.drawCell(t,s,h,l)}}},{key:"setDimensions",value:function(){this.width=this.height=0,this.width=this.width+this.cellSpace*this.columns+this.cellSize*this.columns,this.canvasElem.width(this.width),this.height=this.height+this.cellSpace*this.rows+this.cellSize*this.rows,this.canvasElem.height(this.height)}},{key:"setNoGridOn",value:function(){this.cellSize=this.zoom+1,this.cellSpace=0}},{key:"setNoGridOff",value:function(){this.cellSize=this.zoom,this.cellSpace=1}},{key:"drawCell",value:function(e,t,s,i){i?this.age[e][t]>-1&&(this.context.fillStyle=s):this.trail.current&&this.age[e][t]<0?this.context.fillStyle="#ffffff":this.context.fillStyle="#000000",this.context.fillRect(this.cellSpace+this.cellSpace*e+this.cellSize*e,this.cellSpace+this.cellSpace*t+this.cellSize*t,this.cellSize,this.cellSize)}},{key:"switchCell",value:function(e,t){var s=this.game.currentState;if(s.hasCell(e,t))s.removeCell(e,t);else{var i=this.helper.randomPrimaryColor();s.addCell(e,t,i)}this.draw(s)}},{key:"mousePosition",value:function(e){var t,s,i,l=0,h=0,n=0,o=0,a=GOL.zoom.schemes[GOL.zoom.current].cellSize+1,c=e||window.event;for(c.pageX||c.pageY?(l=c.pageX,h=c.pageY):(c.clientX||c.clientY)&&(l=c.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,h=c.clientY+document.body.scrollTop+document.documentElement.scrollTop),i=c.target||c.srcElement;i.offsetParent;)o+=i.offsetLeft,n+=i.offsetTop,i=i.offsetParent;return i.pageTop=n,i.pageLeft=o,t=Math.ceil((l-i.pageLeft)/a-1),s=Math.ceil((h-i.pageTop)/a-1),[t,s]}},{key:"canvasMouseDown",value:function(e){var t=this.mousePosition(e);this.switchCell(t[0],t[1]),this.handlers.lastX=t[0],this.handlers.lastY=t[1],this.handlers.mouseDown=!0}},{key:"canvasMouseUp",value:function(){this.handlers.mouseDown=!1}},{key:"canvasMouseMove",value:function(e){if(this.handlers.mouseDown){var t=this.mousePosition(e);t[0]===this.handlers.lastX&&t[1]===this.handlers.lastY||(this.switchCell(t[0],t[1]),this.handlers.lastX=t[0],this.handlers.lastY=t[1])}}}]),e}();