"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),GOLGameState=function(){function t(){_classCallCheck(this,t),this.reset()}return _createClass(t,[{key:"reset",value:function(){this.currentState=[],this.nextState=[],this.topPointer=1,this.middlePointer=1,this.bottomPointer=1}},{key:"nextGeneration",value:function(){var t,e=0,r={},i=[];this.nextState=[];for(var n=0;n<this.currentState.length;n++){this.topPointer=1,this.bottomPointer=1;for(var o=[],s=this.currentState[n].x,a=this.currentState[n].y,u=s-1;u<=s+1;u++)for(var h=a-1;h<=a+1;h++){var l=this.currentState.getCell(u,h);l&&o.push(cell)}for(var c=1;c<this.currentState[n].length;c++){var v=this.currentState[n][c],f=this.currentState[n][0];deadNeighbours=[[v-1,f-1,1],[v,f-1,1],[v+1,f-1,1],[v-1,f,1],[v+1,f,1],[v-1,f+1,1],[v,f+1,1],[v+1,f+1,1]],neighbours=this.getNeighboursFromAlive(v,f,n,deadNeighbours);for(var S=0;S<8;S++)void 0!==deadNeighbours[S]&&(t=deadNeighbours[S][0]+","+deadNeighbours[S][1],void 0===r[t]?r[t]=1:r[t]++);0===neighbours||1===neighbours||neighbours>3?this.nextState.push([v,f,0]):(this.addCell(v,f,i),e++,this.nextState.push([v,f,2]))}}for(t in r)if(3===r[t]){t=t.split(",");var d=parseInt(t[0],10),g=parseInt(t[1],10);this.addCell(d,g,i),e++,this.nextState.push([d,g,1])}return this.currentState=i,e}},{key:"getNeighboursFromAlive",value:function(t,e,r,i){var n,o=0;if(void 0!==this.currentState[r-1]&&this.currentState[r-1][0]===e-1)for(n=this.topPointer;n<this.currentState[r-1].length&&!(this.currentState[r-1][n]>=t-1&&(this.currentState[r-1][n]===t-1&&(i[0]=void 0,this.topPointer=n+1,o++),this.currentState[r-1][n]===t&&(i[1]=void 0,this.topPointer=n,o++),this.currentState[r-1][n]===t+1&&(i[2]=void 0,1==n?this.topPointer=1:this.topPointer=n-1,o++),this.currentState[r-1][n]>t+1));n++);for(n=1;n<this.currentState[r].length&&!(this.currentState[r][n]>=t-1&&(this.currentState[r][n]===t-1&&(i[3]=void 0,o++),this.currentState[r][n]===t+1&&(i[4]=void 0,o++),this.currentState[r][n]>t+1));n++);if(void 0!==this.currentState[r+1]&&this.currentState[r+1][0]===e+1)for(n=this.bottomPointer;n<this.currentState[r+1].length&&!(this.currentState[r+1][n]>=t-1&&(this.currentState[r+1][n]===t-1&&(i[5]=void 0,this.bottomPointer=n+1,o++),this.currentState[r+1][n]===t&&(i[6]=void 0,this.bottomPointer=n,o++),this.currentState[r+1][n]===t+1&&(i[7]=void 0,1==n?this.bottomPointer=1:this.bottomPointer=n-1,o++),this.currentState[r+1][n]>t+1));n++);return o}},{key:"getCell",value:function(t,e,r){var i=this.getCellIndex(t,e,r);return i===-1?null:r[i]}},{key:"getCellIndex",value:function(t,e,r){for(var i=0;i<r.length;i++)if(r[i].isAt(t,e))return i;return-1}},{key:"isAlive",value:function(t,e,r){return this.getCellIndex(t,e)!==-1}},{key:"removeCell",value:function(t,e,r){var i=this.getCellIndex(t,e,r);if(i!==-1)return r[i].splice(i,1)}},{key:"addCell",value:function(t,e,r,i){var n=new Cell(t,e,r);if(0===i.length)return i.push(n),n;if(e<i[0].y)return i.unshift(n),n;if(e>i[i.length-1][0])return i.push(n),n;for(var o=0;o<i.length;o++)if(!(i[o].y<e)){for(;i[o].y===e&&i[o].x<t&&o<i.length;)o++;return i.splice(o-1,0,n),n}}}]),t}();